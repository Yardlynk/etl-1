machine:
  timezone:
    America/Los_Angeles
  ruby:
    version: 2.3.3
  hosts:
    circlehost: 127.0.0.1
  environment:
    ETL_CONFIG_DIR: "$HOME/config"
    REDSHIFT_PASSWORD: "$REDSHIFT_PASSWORD"
    INFLUXDB_PASSWORD: "$INFLUXDB_PASSWORD"
    DATABASE_PASSWORD: "$DATABASE_PASSWORD"
  # services:
  #   - postgresql

dependencies:
  pre:
    - gem update --system
    - gem install bundler
    - mkdir "$HOME/empty"        # Use an empty directory for jobs
    - mkdir "$HOME/config"
    - "$HOME/etl/bin/generate_config_files -i $HOME/etl/etc/erb_templates/ -o $HOME/config/ --job-dir $HOME/empty --class-dir $HOME/empty"

database:
  pre:
    - bundle exec etl schema create
  override:
    - "docker run --name outreach-dw -p 5432:5432 -e POSTGRES_PASSWORD=${DATABASE_PASSWORD} -e POSTGRES_USER=root -e POSTGRES_DB=test -d postgres"


test:
  override:
    - bundle exec rspec --color --require spec_helper spec --format progress --tag '~skip'
